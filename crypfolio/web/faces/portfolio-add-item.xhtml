<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui">

    <!--            =====================               modal window PORTFOLIO: ADD NEW ITEM -->
    <div id="divPortfolioAddItem">

        <p:dialog header="Add item to Portfolio" id="dlgPortfolioAddItem" widgetVar="dlgPortfolioAddItem" modal="true"
                  resizable="false" draggable="false" position="center top" closeOnEscape="true"
                  hideEffect="fade" class="modal-window">

            <h:form id="formPortfolioAddItem-coin">

                <h:panelGrid style="width: 100%;">

                    <!--   COIN CHOOSING AUTOCOMPLETE FORM   -->
                    <p:outputLabel value="Coin Name" for="portfolio-add-coin-name"/>

                    <p:outputPanel class="input-group" id="portfolio-add-coin-input-group"
                                   rendered="#{transactionsBacking.coinTemp eq null}">

                        <span class="input-group-addon" id="portfolio-add-coin-img">
                            <i class="fab fa-btc" aria-hidden="true"></i>
                        </span>

                        <p:autoComplete id="portfolio-add-coin-name" value="#{transactionsBacking.coinTemp}"
                                        completeMethod="#{transactionsBacking.completeCoinTemp}"
                                        var="coinTemp"
                                        itemValue="#{coinTemp}"
                                        converter="#{autocompleteCoinConverter}" forceSelection="true"
                                        maxResults="5" required="true" cache="true"
                                        styleClass="form-control noshadow"
                                        placeholder="Coin Name or Ticker">

                            <p:column style="width:32px; text-align:center;">
                                <p:graphicImage
                                        value="https://s2.coinmarketcap.com/static/img/coins/32x32/#{coinTemp.id}.png"
                                        width="32" height="32"/>
                            </p:column>

                            <p:column style="display: flex; justify-content: space-between; margin-top: 5px;">
                                #{coinTemp.name} <h:outputText style="margin: 0 10px;" value="#{coinTemp.symbol}"/>
                            </p:column>

                            <p:ajax event="itemSelect"
                                    update="formPortfolioAddItem-coin mainTabView:formPortfolioAddItem-transaction"/>
                            <p:ajax event="itemSelect" listener="#{transactionsBacking.createItemTemp}"/>

                        </p:autoComplete>

                    </p:outputPanel>

                    <!--   COIN CHOOSING LIST OF USER's CURRENT ITEMS FORM   -->
                    <p:outputPanel rendered="#{transactionsBacking.coinTemp eq null}">

                        <h:outputText styleClass="span-10px-height"/>

                        <p:outputLabel value="Coins in your portfolio:" for="portfolio-list-currents-items"/>

                        <h:outputText styleClass="span-10px-height" style="height: 5px;"/>

                        <p:scrollPanel mode="native" style="width:100%; height:300px;">
                            <p:dataTable id="portfolio-list-currents-items"
                                         styleClass="noHeader"
                                         value="#{portfolioBacking.activeUser.user.portfolio.items}"
                                         var="itemEntity"
                                         sortBy="#{itemEntity.coin.name}">

                                <p:column style="display: flex; justify-content: space-between;">
                                            <div style="padding: 5px;">
                                                <h:graphicImage styleClass="symbol-image-32px"
                                                                value="https://s2.coinmarketcap.com/static/img/coins/32x32/#{itemEntity.coin.id}.png"
                                                                width="32" height="32"/>
                                            </div>

                                            <div style="line-height: 2; padding: 5px;">
                                                <h:outputText value="#{itemEntity.coin.name}"
                                                              style="font-weight:bold;" styleClass="left"/>
                                            </div>

                                            <div style="margin-left: auto; line-height: 2; padding: 5px;">
                                                <h:outputText value="#{itemEntity.coin.symbol}"/>
                                            </div>

                                </p:column>

                            </p:dataTable>
                        </p:scrollPanel>

                    </p:outputPanel>

                </h:panelGrid>

            </h:form>

            <!--   I'm trying to use different h:forms to choose Item-Coin and then to create new Item-Transaction-->
            <p:outputPanel id="portfolioAddItem-transaction-panel">

                <h:form id="formPortfolioAddItem-transaction">
                    <h:panelGrid style="width: 100%;">
                        <p:outputPanel rendered="#{transactionsBacking.itemTemp.coin != null}">

                            <p:outputPanel style="display: flex;">

                                <h:graphicImage
                                        value="https://s2.coinmarketcap.com/static/img/coins/32x32/#{transactionsBacking.itemTemp.coin.id}.png"
                                        style="height: 32px;"/>

                                <h:outputText
                                        value="#{transactionsBacking.itemTemp.coin.name} (#{transactionsBacking.itemTemp.coin.symbol})"
                                        styleClass="coin-item-name-autocompleted"/>

                            </p:outputPanel>

                            <h:outputText styleClass="span-10px-height"/>

                            <h:panelGrid style="width: 100%; border-spacing: 0;">

                                <!--   AMOUNT   BUY/SELL   -->
                                <p:outputPanel style="display: flex;">
                                    <p:outputLabel value="Amount" for="add-transaction-amount"/>

                                    <p:selectOneButton id="add-transaction-type"
                                                       required="true" unselectable="false"
                                                       converter="#{selectOneButtonTransactionTypeConverter}"
                                                       value="#{transactionsBacking.transactionTemp.type}">

                                        <p:ajax oncomplete="showButtonSellAll();"/>

                                        <f:selectItem itemLabel="BUY" itemValue="BUY"/>
                                        <f:selectItem itemLabel="SELL" itemValue="SELL"/>

                                    </p:selectOneButton>
                                </p:outputPanel>

                                <!--   AMOUNT   -->
                                <p:outputPanel class="input-group" style="display: flex;">
                                    <p:inputNumber id="add-transaction-amount"
                                                   required="true"
                                                   styleClass="form-control form-control-right noshadow"
                                                   minValue="0" maxValue="999999999999.99999999" placeholder="0"
                                                   decimalSeparator="." thousandSeparator=","
                                                   decimalPlaces="8" padControl="false"
                                                   value="#{transactionsBacking.transactionTemp.amount}">

                                        <p:ajax event="keyup" oncomplete="enableDoneButton();" process="@this"
                                                listener="#{transactionsBacking.autoRecalculateTransactionInputData('amount')}"
                                                update="add-transaction-total"/>

                                    </p:inputNumber>

                                    <!--   AMOUNT   ALL   -->
                                    <p:commandButton style="display: none;"
                                                     id="add-transaction-amount-sell-all"
                                                     value="All"
                                                     update="add-transaction-amount add-transaction-total"
                                                     process="@this"
                                                     actionListener="#{transactionsBacking.getItemAllAmount}"
                                                     oncomplete="enableDoneButton();"/>
                                    <!--resetValues="true" is it necesary to reset amount input validation???-->
                                    <!--   call also method autoRecalculateTransactionInputData('amount') from this bean's listener!   -->

                                    <h:outputText styleClass="input-group-addon input-group-addon-right"
                                                  value="#{transactionsBacking.itemTemp.coin.symbol}"/>
                                </p:outputPanel>

                                <!--   MARKET PRICE   -->
                                <p:outputPanel style="display: flex;">

                                    <p:outputLabel value="Price" for="add-transaction-price"/>

                                    <p:commandButton id="add-transaction-market-price"
                                                     value="Market Price"
                                                     update="add-transaction-price add-transaction-total"
                                                     process="@this"
                                                     style="margin-left: 10px;"
                                                     actionListener="#{transactionsBacking.setActualTransactionPriceTemp}"
                                                     oncomplete="enableDoneButton();"
                                                     resetValues="true"/>
                                    <!--resetValues="true" is it necesary (important) to reset input validation???-->
                                    <!--   call also method autoRecalculateTransactionInputData('price') from this bean's listener!   -->

                                </p:outputPanel>

                                <!--   PRICE   -->
                                <p:outputPanel style="display: flex;">
                                    <p:inputNumber id="add-transaction-price"
                                                   required="true"
                                                   styleClass="form-control form-control-right noshadow"
                                                   minValue="0" maxValue="999999999999.99999999" placeholder="0"
                                                   decimalSeparator="." thousandSeparator=","
                                                   decimalPlaces="8" padControl="false"
                                                   value="#{transactionsBacking.transactionPriceTemp}">

                                        <p:ajax event="keyup" oncomplete="enableDoneButton();" process="@this"
                                                listener="#{transactionsBacking.autoRecalculateTransactionInputData('price')}"
                                                update="add-transaction-total"/>

                                    </p:inputNumber>

                                    <!--   PRICE   CURRENCIES   -->
                                    <p:selectOneMenu id="add-transaction-price-currency"
                                                     required="true" type="input"
                                                     converter="#{selectOneMenuCurrencyTypeConverter}"
                                                     value="#{transactionsBacking.transactionTemp.boughtCurrency}"
                                                     effect="none" class="selectonemenu-right noshadow">

                                        <f:selectItems value="#{transactionsBacking.currencies}"/>

                                        <p:ajax event="itemSelect"
                                                update="add-transaction-price add-transaction-total-currency add-transaction-total"
                                                oncomplete="enableDoneButton();"
                                                listener="#{transactionsBacking.setActualTransactionPriceTemp}"
                                                resetValues="true"/>
                                        <!--resetValues="true" is it necesary (important) to reset input validation???-->
                                        <!--   call also method autoRecalculateTransactionInputData('price') from this bean's listener!   -->

                                    </p:selectOneMenu>

                                </p:outputPanel>

                                <!--   TOTAL   -->
                                <p:outputLabel value="Total" for="add-transaction-total"/>

                                <p:outputPanel class="input-group">
                                    <p:inputNumber id="add-transaction-total"
                                                   required="true"
                                                   styleClass="form-control form-control-right noshadow"
                                                   minValue="0" maxValue="999999999999.99999999" placeholder="0"
                                                   decimalSeparator="." thousandSeparator=","
                                                   decimalPlaces="8" padControl="false"
                                                   value="#{transactionsBacking.transactionTotalTemp}">

                                        <p:ajax event="keyup" oncomplete="enableDoneButton();" process="@this"
                                                listener="#{transactionsBacking.autoRecalculateTransactionInputData('total')}"
                                                update="add-transaction-price add-transaction-amount"/>

                                    </p:inputNumber>

                                    <h:outputText id="add-transaction-total-currency"
                                                  class="input-group-addon input-group-addon-right"
                                                  value="#{transactionsBacking.transactionTemp.boughtCurrency}"/>
                                </p:outputPanel>

                                <h:outputText styleClass="span-10px-height" style="height: 5px;"/>

                                <!--   DATE   -->
                                <p:outputPanel class="input-group" style="display: flex; justify-content: flex-start;">
                                    <p:outputLabel for="add-transaction-date" value="Date:" style="margin-top: 5px;"/>

                                    <p:calendar id="add-transaction-date"
                                                readonlyInput="true"
                                                value="#{transactionsBacking.transactionTemp.boughtDate}"
                                                pattern="dd MMMM, yyyy" mask="false" locale="en_US"
                                                navigator="true" maxdate="today"
                                                styleClass="form-control form-control-center noshadow"
                                                style="padding-left: 20px;"
                                                placeholder="#{transactionsBacking.datePlaceholder}"
                                                converter="calendarLocalDateConverter">

                                    </p:calendar>

                                </p:outputPanel>

                                <h:outputText styleClass="span-10px-height" style="height: 5px;"/>

                                <!--   COMMENT   -->
                                <p:accordionPanel activeIndex="null">
                                    <p:tab title="Comment">

                                        <p:inputTextarea id="add-transaction-comment"
                                                         styleClass="form-control noshadow"
                                                         rows="5" autoResize="false"
                                                         counter="add-transaction-comment-counter" maxlength="200"
                                                         counterTemplate="{0} characters remaining."
                                                         value="#{transactionsBacking.transactionTemp.comment}"/>
                                        <h:outputText id="add-transaction-comment-counter"/>

                                    </p:tab>
                                </p:accordionPanel>

                            </h:panelGrid>

                            <h:outputText styleClass="span-10px-height"/>

                            <p:outputPanel>
                                <h:panelGrid style="margin: auto;">
                                    <p:outputPanel>

                                        <!--   RESET   -->
                                        <p:commandButton id="add-transaction-reset"
                                                         icon="ui-icon-arrowreturnthick-1-w"
                                                         value="Reset"
                                                         resetValues="true"
                                                         type="reset"
                                                         style="margin-right: 20px;"
                                                         update="formPortfolioAddItem-transaction"
                                                         process="@this">

                                            <p:ajax listener="#{transactionsBacking.transactionAddFormReset}"
                                                    update="formPortfolioAddItem-transaction
                                                     mainTabView:formPortfolioAddItem-coin"/>

                                        </p:commandButton>

                                        <!--   DONE   -->
                                        <p:commandButton id="add-transaction-done"
                                                         actionListener="#{transactionsBacking.doSubmitAddTransaction}"
                                                         value="Done"
                                                         icon="ui-icon-check"
                                                         styleClass="ui-state-disabled"
                                                         oncomplete="PF('dlgPortfolioAddItem').hide();"
                                                         update="mainTabView:portfolioPanel mainTabView:archivePanel @form growl"
                                                         resetValues="true">
                                        </p:commandButton>

                                    </p:outputPanel>
                                </h:panelGrid>
                            </p:outputPanel>

                        </p:outputPanel>
                    </h:panelGrid>
                </h:form>

            </p:outputPanel>

            <!-- ¿¿¿formPortfolioAddItem-transaction:add-transaction-amount and other don't reset input error css class???-->
            <p:ajax event="close" listener="#{transactionsBacking.transactionAddFormReset}"
                    update="formPortfolioAddItem-coin formPortfolioAddItem-transaction
                        formPortfolioAddItem-transaction:add-transaction-amount
                        formPortfolioAddItem-transaction:add-transaction-price
                        formPortfolioAddItem-transaction:add-transaction-total"
                    resetValues="true"/>

        </p:dialog>

    </div>

</ui:composition>